<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=375px, initial-scale=1.0">
  <title>ì§€ë„ê²€ìƒ‰</title>
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7c64a249ef8e3b9b648f20a50c07b249"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#7C3AED',
            secondary: '#6D28D9'
          },
          borderRadius: {
            'none': '0px',
            'sm': '4px',
            DEFAULT: '8px',
            'md': '12px',
            'lg': '16px',
            'xl': '20px',
            '2xl': '24px',
            '3xl': '32px',
            'full': '9999px',
            'button': '8px'
          }
        }
      }
    }
  </script>
  <style>
    :where([class^="ri-"])::before {
      content: "\f3c2";
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-5px);
      }
    }

    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out forwards;
    }

    .animate-scaleIn {
      animation: scaleIn 0.3s ease-out forwards;
    }

    .animate-bounce {
      animation: bounce 2s infinite;
    }

    .hover-float:hover {
      transform: translateY(-5px);
      transition: transform 0.3s ease;
    }

    /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
    ::-webkit-scrollbar {
      display: none;
    }

    * {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .calendar-day {
      aspect-ratio: 1/1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin: 1px;
      transition: all 0.2s;
    }

    .calendar-day:hover {
      background-color: rgba(124, 58, 237, 0.1);
    }

    .calendar-day.selected {
      background-color: #7C3AED;
      color: white;
    }

    .calendar-day.in-range {
      background-color: rgba(124, 58, 237, 0.1);
    }

    .calendar-day.disabled {
      color: #D1D5DB;
      pointer-events: none;
      cursor: not-allowed;
    }

    /* ìº˜ë¦°ë” ëª¨ë‹¬ ë§ˆì§„ ì œê±° */
    #calendarModal {
      margin: 0 !important;
      padding: 0 !important;
    }

    /* ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
    .wishlist-btn {
      transition: all 0.3s ease;
    }

    .wishlist-btn:hover {
      transform: scale(1.1);
    }

    .wishlist-btn.active {
      color: #ef4444 !important;
      transform: scale(1.2);
    }

    .wishlist-btn i {
      transition: all 0.2s ease;
    }
  </style>
</head>

<body class="bg-[#F8F7FF] min-h-[762px]">
  <nav class="fixed top-0 left-0 right-0 bg-white z-50 shadow-sm">
    <div class="flex items-center px-4 h-16">
      <a href="#" onclick="event.preventDefault(); history.back();" data-readdy="true"
        class="w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-gray-50 rounded-full">
        <i class="ri-arrow-left-s-line text-xl"></i>
      </a>
      <div class="flex-1 flex justify-center gap-6">
        <a href="search.html" data-readdy="true" class="text-gray-400 hover:text-gray-600">ìˆ™ì†Œê²€ìƒ‰</a>
        <button
          class="text-primary font-medium relative after:absolute after:bottom-[-14px] after:left-0 after:w-full after:h-[2px] after:bg-primary">ì§€ë„ê²€ìƒ‰</button>
      </div>
      <a href="./index.html" data-readdy="true"
        class="w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-gray-50 rounded-full">
        <i class="ri-home-5-line text-xl"></i>
      </a>
    </div>
  </nav>

  <!-- ìº˜ë¦°ë” ëª¨ë‹¬ (search.html ìŠ¤íƒ€ì¼) -->
  <div id="calendarModal" class="fixed inset-0 bg-black/50 z-50 hidden">
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 max-h-[80vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-medium">ë‚ ì§œ ì„ íƒ</h3>
        <button type="button" id="closeCalendarModal"
          class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100">
          <i class="ri-close-line text-xl"></i>
        </button>
      </div>

      <!-- ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ í‘œì‹œ -->
      <div class="flex justify-between mb-4">
        <div class="w-[48%] p-3 border border-gray-200 rounded-lg">
          <p class="text-sm text-gray-500">ì²´í¬ì¸</p>
          <p class="text-lg font-medium" id="check-in-date">ë‚ ì§œ ì„ íƒ</p>
        </div>
        <div class="w-[48%] p-3 border border-gray-200 rounded-lg">
          <p class="text-sm text-gray-500">ì²´í¬ì•„ì›ƒ</p>
          <p class="text-lg font-medium" id="check-out-date">ë‚ ì§œ ì„ íƒ</p>
        </div>
      </div>
      <div class="mb-4 text-center">
        <p class="text-gray-500" id="nights-count">0ë°•</p>
      </div>

      <!-- ë‹¬ë ¥ -->
      <div class="calendar-container mb-5">
        <div class="flex justify-between items-center mb-4">
          <button id="prev-month" class="w-10 h-10 flex items-center justify-center cursor-pointer">
            <i class="ri-arrow-left-s-line ri-lg"></i>
          </button>
          <h3 class="text-lg font-medium" id="current-month">2025ë…„ 7ì›”</h3>
          <button id="next-month" class="w-10 h-10 flex items-center justify-center cursor-pointer">
            <i class="ri-arrow-right-s-line ri-lg"></i>
          </button>
        </div>
        <div class="calendar-weekdays grid grid-cols-7 text-center mb-2">
          <div class="text-sm text-red-500 font-medium">ì¼</div>
          <div class="text-sm text-gray-500 font-medium">ì›”</div>
          <div class="text-sm text-gray-500 font-medium">í™”</div>
          <div class="text-sm text-gray-500 font-medium">ìˆ˜</div>
          <div class="text-sm text-gray-500 font-medium">ëª©</div>
          <div class="text-sm text-gray-500 font-medium">ê¸ˆ</div>
          <div class="text-sm text-blue-500 font-medium">í† </div>
        </div>
        <div class="calendar-grid" id="calendar-days">
          <!-- ë‹¬ë ¥ ë‚ ì§œëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
      </div>

      <!-- í™•ì¸ ë²„íŠ¼ -->
      <button type="button" id="confirmCalendarSelection"
        class="w-full py-3 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-colors">
        ë‚ ì§œ ì„ íƒ ì™„ë£Œ
      </button>
    </div>
  </div>

  <main class="pt-20 px-4 pb-20">
    <div class="space-y-4 pb-6">
      <!-- ê²€ìƒ‰ ì¡°ê±´ ì„ íƒ ì˜ì—­ -->
      <div class="space-y-4">
        <!-- ë‚ ì§œ ì„ íƒ UI (search.htmlê³¼ ë™ì¼) -->
        <div class="relative">
          <div class="absolute inset-y-0 left-3 flex items-center">
            <img
              src="https://readdy.ai/api/search-image?query=3D%20icon%20of%20a%20calendar%2C%20modern%20design%2C%20soft%20gradients%2C%20centered%20composition%2C%20isolated%20on%20transparent%20background%2C%20smooth%20shading&width=32&height=32&seq=3&orientation=squarish"
              class="w-6 h-6" alt="calendar">
          </div>
          <button type="button" id="dateSelector"
            class="w-full h-14 pl-12 pr-4 rounded-xl bg-white shadow-sm hover:shadow-md transition-shadow duration-300 focus:outline-none text-left flex items-center justify-between">
            <span id="selectedDateText">ì²´í¬ì¸ - ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
            <i class="ri-arrow-down-s-line text-gray-400"></i>
          </button>
        </div>
        <div class="flex gap-3 overflow-x-auto py-2 no-scrollbar">
          <div class="flex gap-3 min-w-max pb-2" id="campingTypeFilter">
            <button class="flex flex-col items-center gap-1 px-3 py-2 bg-primary/10 shadow-md rounded-xl cursor-pointer"
              data-type="normal">
              <div
                class="w-12 h-12 flex items-center justify-center bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl">
                <i class="ri-home-8-line text-xl text-primary hover:rotate-6"></i>
              </div>
              <span class="text-xs whitespace-nowrap text-primary font-medium">ì¼ë°˜ìº í•‘</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="glamping">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-hotel-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">ê¸€ë¨í•‘</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="caravan">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-truck-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">ì¹´ë¼ë°˜</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="pension">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-building-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">íœì…˜</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="hotel">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-hotel-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">í˜¸í…”</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="pet">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-heart-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">ë°˜ë ¤ë™ë¬¼</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="sharing">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-home-4-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">ê³µìœ ìˆ™ë°•</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="hotspring">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-water-flash-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">ì˜¨ì²œ</span>
            </button>
            <button
              class="flex flex-col items-center gap-1 px-3 py-2 bg-white shadow-sm hover:shadow-md rounded-xl cursor-pointer"
              data-type="resort">
              <div class="w-10 h-10 flex items-center justify-center rounded-xl">
                <i class="ri-hotel-line text-xl text-gray-500"></i>
              </div>
              <span class="text-xs whitespace-nowrap">ë¦¬ì¡°íŠ¸</span>
            </button>
          </div>
        </div>
        <!-- ì¸ì› ì„ íƒ UI (search.htmlê³¼ ë™ì¼) -->
        <div class="bg-white rounded-xl p-4 shadow-sm">
          <div class="flex items-center gap-3 mb-4">
            <img
              src="https://readdy.ai/api/search-image?query=3D%20icon%20of%20a%20person%2C%20modern%20design%2C%20soft%20gradients%2C%20centered%20composition%2C%20isolated%20on%20transparent%20background%2C%20smooth%20shading&width=32&height=32&seq=4&orientation=squarish"
              class="w-6 h-6" alt="user">
            <span class="font-medium">ì¸ì› ì„ íƒ</span>
          </div>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-sm">ì„±ì¸</span>
              <div class="flex items-center gap-3">
                <button type="button" id="adult-minus"
                  class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50">
                  <i class="ri-subtract-line text-sm"></i>
                </button>
                <span id="adult-count" class="w-8 text-center font-medium">0</span>
                <button type="button" id="adult-plus"
                  class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50">
                  <i class="ri-add-line text-sm"></i>
                </button>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">ì†Œì¸</span>
              <div class="flex items-center gap-3">
                <button type="button" id="child-minus"
                  class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50">
                  <i class="ri-subtract-line text-sm"></i>
                </button>
                <span id="child-count" class="w-8 text-center font-medium">0</span>
                <button type="button" id="child-plus"
                  class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50">
                  <i class="ri-add-line text-sm"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì§€ë„ ì˜ì—­ -->
      <div class="relative h-[500px] overflow-hidden rounded-xl shadow-sm">
        <!-- ì¹´ì¹´ì˜¤ ì§€ë„ ì»¨í…Œì´ë„ˆ -->
        <div id="map" class="w-full h-full rounded-xl"></div>

        <!-- ìˆ™ì†Œ ì •ë³´ íŒì—… (ì§€ë„ ì»¨í…Œì´ë„ˆ ì•ˆì— ìœ„ì¹˜) -->
        <div id="infoPopup"
          class="hidden absolute w-[280px] h-[200px] bg-white rounded-xl shadow-2xl z-50 border border-gray-100">
          <div class="relative h-[80px]">
            <img id="popupImage" src="" class="w-full h-full object-cover rounded-t-xl" alt="ìˆ™ì†Œ ì´ë¯¸ì§€">
            <button id="closePopup"
              class="absolute top-2 right-2 w-6 h-6 flex items-center justify-center bg-black/50 hover:bg-black/70 rounded-full text-white cursor-pointer transition-colors">
              <i class="ri-close-line text-sm"></i>
            </button>
          </div>
          <div class="p-3 h-[120px] flex flex-col justify-between">
            <div>
              <h3 id="popupTitle" class="font-medium text-sm mb-1 truncate"></h3>
              <div class="flex items-center gap-1 mb-2">
                <i class="ri-star-fill text-yellow-400 text-xs"></i>
                <span id="popupRating" class="text-xs"></span>
                <span class="text-gray-400 text-xs">Â·</span>
                <span id="popupReviews" class="text-gray-400 text-xs truncate"></span>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <div>
                <p id="popupPrice" class="font-medium text-primary text-sm"></p>
                <p class="text-xs text-gray-500">1ë°• ê¸°ì¤€</p>
              </div>
              <button id="popupDetailBtn"
                class="px-3 py-1.5 bg-primary hover:bg-primary/90 text-white rounded-lg text-xs cursor-pointer transition-colors">ìì„¸íˆ
                ë³´ê¸°</button>
            </div>
          </div>
        </div>

        <!-- ì§€ë„ ì»¨íŠ¸ë¡¤ -->
        <div class="absolute bottom-4 right-4 flex flex-col gap-2 z-10">
          <button id="zoomIn"
            class="w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-md cursor-pointer hover:bg-gray-50">
            <i class="ri-add-line text-xl"></i>
          </button>
          <button id="zoomOut"
            class="w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-md cursor-pointer hover:bg-gray-50">
            <i class="ri-subtract-line text-xl"></i>
          </button>
          <button id="currentLocation"
            class="w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-md cursor-pointer hover:bg-gray-50">
            <i class="ri-map-pin-user-line text-xl text-primary"></i>
          </button>
        </div>
      </div>
    </div>
  </main>

  <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-md border-t border-gray-100 z-10">
    <button id="searchButton"
      class="w-full h-14 bg-primary text-white font-medium rounded-xl shadow-lg shadow-primary/25 hover:shadow-primary/40 transition-shadow duration-300">
      ê²€ìƒ‰
    </button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // ë‚ ì§œ ì„ íƒ ê¸°ëŠ¥ (search.html ìŠ¤íƒ€ì¼)
      const dateSelectorBtn = document.getElementById('dateSelector');
      const calendarModal = document.getElementById('calendarModal');
      const closeCalendarModalBtn = document.getElementById('closeCalendarModal');
      const calendarDaysEl = document.getElementById('calendar-days');
      const currentMonthText = document.getElementById('current-month');
      const prevMonthButton = document.getElementById('prev-month');
      const nextMonthButton = document.getElementById('next-month');
      const checkInDateText = document.getElementById('check-in-date');
      const checkOutDateText = document.getElementById('check-out-date');
      const nightsCountText = document.getElementById('nights-count');
      const confirmCalendarBtn = document.getElementById('confirmCalendarSelection');

      let currentCalendarDate = new Date();
      let selectedStartCalendarDate = null;
      let selectedEndCalendarDate = null;

      // ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜
      function formatCalendarDate(date) {
        if (!date) return '';
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        return `${year}.${month < 10 ? '0' + month : month}.${day < 10 ? '0' + day : day}`;
      }

      function formatCalendarDateRange(checkin, checkout) {
        if (!checkin || !checkout) return 'ì²´í¬ì¸ - ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”';
        const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));
        const options = { month: '2-digit', day: '2-digit', weekday: 'short' };
        const checkinStr = checkin.toLocaleDateString('ko-KR', options);
        const checkoutStr = checkout.toLocaleDateString('ko-KR', options);
        return `${checkinStr} - ${checkoutStr}, ${nights}ë°•${nights + 1}ì¼`;
      }

      // ë‹¬ë ¥ ìƒì„± í•¨ìˆ˜
      function renderCalendarView() {
        calendarDaysEl.innerHTML = '';
        const year = currentCalendarDate.getFullYear();
        const month = currentCalendarDate.getMonth();
        currentMonthText.textContent = `${year}ë…„ ${month + 1}ì›”`;

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startingDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();

        // ì´ì „ ë‹¬ì˜ ë‚ ì§œ ì±„ìš°ê¸°
        for (let i = 0; i < startingDayOfWeek; i++) {
          const dayEl = document.createElement('div');
          dayEl.classList.add('calendar-day', 'disabled');
          calendarDaysEl.appendChild(dayEl);
        }

        // í˜„ì¬ ë‹¬ì˜ ë‚ ì§œ ì±„ìš°ê¸°
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let i = 1; i <= daysInMonth; i++) {
          const dayEl = document.createElement('div');
          dayEl.classList.add('calendar-day');
          dayEl.textContent = i;

          const currentDateObj = new Date(year, month, i);

          // ì˜¤ëŠ˜ ì´ì „ ë‚ ì§œëŠ” ë¹„í™œì„±í™”
          if (currentDateObj < today) {
            dayEl.classList.add('disabled');
          } else {
            // ì„ íƒëœ ì‹œì‘ ë‚ ì§œ
            if (selectedStartCalendarDate && currentDateObj.getTime() === selectedStartCalendarDate.getTime()) {
              dayEl.classList.add('selected');
            }
            // ì„ íƒëœ ì¢…ë£Œ ë‚ ì§œ
            if (selectedEndCalendarDate && currentDateObj.getTime() === selectedEndCalendarDate.getTime()) {
              dayEl.classList.add('selected');
            }
            // ì„ íƒ ë²”ìœ„ ë‚´ ë‚ ì§œ
            if (selectedStartCalendarDate && selectedEndCalendarDate &&
              currentDateObj > selectedStartCalendarDate &&
              currentDateObj < selectedEndCalendarDate) {
              dayEl.classList.add('in-range');
            }

            // ë‚ ì§œ í´ë¦­ ì´ë²¤íŠ¸
            dayEl.addEventListener('click', () => {
              if (!selectedStartCalendarDate || (selectedStartCalendarDate && selectedEndCalendarDate)) {
                // ìƒˆë¡œìš´ ì„ íƒ ì‹œì‘
                selectedStartCalendarDate = currentDateObj;
                selectedEndCalendarDate = null;
                checkInDateText.textContent = formatCalendarDate(selectedStartCalendarDate);
                checkOutDateText.textContent = 'ë‚ ì§œ ì„ íƒ';
                nightsCountText.textContent = '0ë°•';
              } else {
                // ì´ë¯¸ ì‹œì‘ ë‚ ì§œê°€ ì„ íƒëœ ê²½ìš°
                if (currentDateObj < selectedStartCalendarDate) {
                  // ì„ íƒëœ ë‚ ì§œê°€ ì‹œì‘ ë‚ ì§œë³´ë‹¤ ì´ì „ì¸ ê²½ìš°
                  selectedEndCalendarDate = selectedStartCalendarDate;
                  selectedStartCalendarDate = currentDateObj;
                } else {
                  // ì¢…ë£Œ ë‚ ì§œ ì„ íƒ
                  selectedEndCalendarDate = currentDateObj;
                }
                checkInDateText.textContent = formatCalendarDate(selectedStartCalendarDate);
                checkOutDateText.textContent = formatCalendarDate(selectedEndCalendarDate);
                // ìˆ™ë°• ì¼ìˆ˜ ê³„ì‚°
                const nights = Math.round((selectedEndCalendarDate - selectedStartCalendarDate) / (1000 * 60 * 60 * 24));
                nightsCountText.textContent = `${nights}ë°•`;
              }
              renderCalendarView();
            });
          }

          calendarDaysEl.appendChild(dayEl);
        }
      }

      // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
      dateSelectorBtn.addEventListener('click', function () {
        calendarModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        renderCalendarView();
      });

      closeCalendarModalBtn.addEventListener('click', function () {
        calendarModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      });

      // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      calendarModal.addEventListener('click', function (e) {
        if (e.target === calendarModal) {
          calendarModal.classList.add('hidden');
          document.body.style.overflow = 'auto';
        }
      });

      // ì´ì „/ë‹¤ìŒ ë‹¬ ë²„íŠ¼
      prevMonthButton.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        renderCalendarView();
      });

      nextMonthButton.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        renderCalendarView();
      });

      // ë‚ ì§œ ì„ íƒ ì™„ë£Œ
      confirmCalendarBtn.addEventListener('click', function () {
        if (selectedStartCalendarDate && selectedEndCalendarDate) {
          if (selectedEndCalendarDate <= selectedStartCalendarDate) {
            alert('ì²´í¬ì•„ì›ƒ ë‚ ì§œëŠ” ì²´í¬ì¸ ë‚ ì§œë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.');
            return;
          }

          const displayText = formatCalendarDateRange(selectedStartCalendarDate, selectedEndCalendarDate);
          document.getElementById('selectedDateText').textContent = displayText;

          calendarModal.classList.add('hidden');
          document.body.style.overflow = 'auto';
          console.log('ì„ íƒëœ ë‚ ì§œ:', displayText);
        } else {
          alert('ì²´í¬ì¸ê³¼ ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
        }
      });

      // ì¸ì› ì„ íƒ ê¸°ëŠ¥ (search.html ìŠ¤íƒ€ì¼)
      const adultCount = document.getElementById('adult-count');
      const adultMinus = document.getElementById('adult-minus');
      const adultPlus = document.getElementById('adult-plus');
      const childCount = document.getElementById('child-count');
      const childMinus = document.getElementById('child-minus');
      const childPlus = document.getElementById('child-plus');

      let adultNumber = 0;
      let childNumber = 0;

      function updatePersonCount() {
        adultCount.textContent = adultNumber;
        childCount.textContent = childNumber;
      }

      adultMinus.addEventListener('click', function () {
        if (adultNumber > 0) {
          adultNumber--;
          updatePersonCount();
        }
      });
      adultPlus.addEventListener('click', function () {
        adultNumber++;
        updatePersonCount();
      });
      childMinus.addEventListener('click', function () {
        if (childNumber > 0) {
          childNumber--;
          updatePersonCount();
        }
      });
      childPlus.addEventListener('click', function () {
        childNumber++;
        updatePersonCount();
      });

      // ìº í•‘ íƒ€ì… í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸ (search.html ìŠ¤íƒ€ì¼)
      const campingTypeButtons = document.querySelectorAll('#campingTypeFilter button');

      campingTypeButtons.forEach(button => {
        button.addEventListener('click', function () {
          // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
          campingTypeButtons.forEach((btn) => {
            btn.classList.remove('bg-primary/10', 'shadow-md');
            btn.classList.add('bg-white', 'shadow-sm', 'hover:shadow-md');

            // ì•„ì´ì½˜ ìƒ‰ìƒ ì´ˆê¸°í™”
            const icon = btn.querySelector('i');
            const span = btn.querySelector('span');
            if (icon) {
              icon.classList.remove('text-primary');
              icon.classList.add('text-gray-500');
            }
            if (span) {
              span.classList.remove('text-primary', 'font-medium');
            }

            // ì•„ì´ì½˜ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            const iconContainer = btn.querySelector('div');
            if (iconContainer) {
              iconContainer.classList.remove('bg-gradient-to-br', 'from-primary/10', 'to-primary/5', 'w-12', 'h-12');
              iconContainer.classList.add('w-10', 'h-10');
            }
          });

          // í´ë¦­ëœ ë²„íŠ¼ í™œì„±í™”
          this.classList.remove('bg-white', 'shadow-sm', 'hover:shadow-md');
          this.classList.add('bg-primary/10', 'shadow-md');

          // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½
          const icon = this.querySelector('i');
          const span = this.querySelector('span');
          if (icon) {
            icon.classList.remove('text-gray-500');
            icon.classList.add('text-primary');
          }
          if (span) {
            span.classList.add('text-primary', 'font-medium');
          }

          // ì„ íƒëœ ë²„íŠ¼ì˜ ì•„ì´ì½˜ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼
          const iconContainer = this.querySelector('div');
          if (iconContainer) {
            iconContainer.classList.add('bg-gradient-to-br', 'from-primary/10', 'to-primary/5', 'w-12', 'h-12');
            iconContainer.classList.remove('w-10', 'h-10');
          }

          console.log('ì„ íƒëœ ìº í•‘ íƒ€ì…:', this.dataset.type);
        });
      });

      // ì¹´ì¹´ì˜¤ ì§€ë„ ì´ˆê¸°í™” ë° ë§ˆì»¤ ìƒì„±
      let map;
      let mapMarkers = [];
      let userLocation = null; // ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ì €ì¥

      // ìˆ™ì†Œ ë°ì´í„° (ê¸°ì¡´ 4ê°œë§Œ ìœ ì§€)
      const accommodations = [
        {
          id: 1,
          title: 'ìˆ²ì† ê¸€ë¨í•‘ ë¦¬ì¡°íŠ¸',
          type: 'glamping',
          lat: 37.8315 + (Math.random() - 0.5) * 0.02, // ê°€í‰ ì¤‘ì‹¬ ì¢Œí‘œì—ì„œ ëœë¤ ì˜¤í”„ì…‹
          lng: 127.5109 + (Math.random() - 0.5) * 0.02,
          price: 'â‚©130,000',
          rating: '4.8',
          reviews: 'ë¦¬ë·° 128ê°œ',
          image: 'https://readdy.ai/api/search-image?query=Luxury%20glamping%20tent%20in%20forest%20setting%2C%20cozy%20interior%20with%20comfortable%20bed%2C%20warm%20lighting%2C%20natural%20wood%20elements%2C%20high-quality%20professional%20photography%2C%20no%20people%2C%20serene%20atmosphere&width=600&height=400&seq=101&orientation=landscape'
        },
        {
          id: 2,
          title: 'ë§ˆìš´í‹´ ë·° ì¹´ë¼ë°˜',
          type: 'caravan',
          lat: 37.8315 + (Math.random() - 0.5) * 0.02,
          lng: 127.5109 + (Math.random() - 0.5) * 0.02,
          price: 'â‚©145,000',
          rating: '4.6',
          reviews: 'ë¦¬ë·° 95ê°œ',
          image: 'https://readdy.ai/api/search-image?query=Modern%20caravan%20camping%20site%20with%20outdoor%20deck%2C%20mountain%20view%2C%20sunset%20lighting%2C%20professional%20photography%2C%20no%20people%2C%20luxury%20camping%20experience&width=600&height=400&seq=102&orientation=landscape'
        },
        {
          id: 3,
          title: 'í•œì˜¥ ìŠ¤íƒ€ì¼ íœì…˜',
          type: 'pension',
          lat: 37.8315 + (Math.random() - 0.5) * 0.02,
          lng: 127.5109 + (Math.random() - 0.5) * 0.02,
          price: 'â‚©120,000',
          rating: '4.7',
          reviews: 'ë¦¬ë·° 156ê°œ',
          image: 'https://readdy.ai/api/search-image?query=Traditional%20Korean%20pension%20house%20with%20wooden%20architecture%2C%20beautiful%20garden%2C%20peaceful%20surroundings%2C%20professional%20photography%2C%20no%20people%2C%20vacation%20rental&width=600&height=400&seq=103&orientation=landscape'
        },
        {
          id: 4,
          title: 'ë ˆì´í¬ ì˜¤í† ìº í•‘ì¥',
          type: 'autoCamping',
          lat: 37.8315 + (Math.random() - 0.5) * 0.02,
          lng: 127.5109 + (Math.random() - 0.5) * 0.02,
          price: 'â‚©160,000',
          rating: '4.9',
          reviews: 'ë¦¬ë·° 210ê°œ',
          image: 'https://readdy.ai/api/search-image?query=Luxury%20auto%20camping%20site%20by%20the%20lake%2C%20modern%20tent%20setup%2C%20campfire%2C%20evening%20atmosphere%2C%20professional%20photography%2C%20no%20people%2C%20outdoor%20adventure&width=600&height=400&seq=104&orientation=landscape'
        }
      ];

      // ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
      function getUserLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject(new Error('Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.'));
            return;
          }

          const options = {
            enableHighAccuracy: true, // ë†’ì€ ì •í™•ë„
            timeout: 10000, // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
            maximumAge: 300000 // 5ë¶„ ë™ì•ˆ ìºì‹œëœ ìœ„ì¹˜ ì‚¬ìš©
          };

          navigator.geolocation.getCurrentPosition(
            (position) => {
              const location = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy
              };
              console.log('ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜:', location);
              resolve(location);
            },
            (error) => {
              console.error('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error);
              let errorMessage = '';
              switch (error.code) {
                case error.PERMISSION_DENIED:
                  errorMessage = 'ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                  break;
                case error.POSITION_UNAVAILABLE:
                  errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                  break;
                case error.TIMEOUT:
                  errorMessage = 'ìœ„ì¹˜ ì •ë³´ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                  break;
                default:
                  errorMessage = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                  break;
              }
              reject(new Error(errorMessage));
            },
            options
          );
        });
      }

      // URL íŒŒë¼ë¯¸í„°ì—ì„œ ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ì¸ì§€ í™•ì¸
      function isLocationBasedAccess() {
        const urlParams = new URLSearchParams(window.location.search);
        const fromNearby = urlParams.get('from') === 'nearby';
        const referer = document.referrer;

        console.log('ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ í™•ì¸:');
        console.log('- URL íŒŒë¼ë¯¸í„° from:', urlParams.get('from'));
        console.log('- fromNearby:', fromNearby);
        console.log('- referer:', referer);

        // URL íŒŒë¼ë¯¸í„°ë¡œ í™•ì¸í•˜ê±°ë‚˜, ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ "ë‚´ ì£¼ë³€" ë²„íŠ¼ìœ¼ë¡œ ì ‘ê·¼í•œ ê²½ìš°
        const isLocationBased = fromNearby || referer.includes('index.html') || referer.includes('search.html') || referer.includes('shop_list.html');

        console.log('- ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ ì—¬ë¶€:', isLocationBased);

        return isLocationBased;
      }

      // ì‚¬ìš©ì ìœ„ì¹˜ ì£¼ë³€ì— ìˆ™ì†Œ ë§ˆì»¤ ì¬ë°°ì¹˜
      function relocateAccommodationsNearUser(userLat, userLng) {
        console.log(`ì‚¬ìš©ì ìœ„ì¹˜: (${userLat}, ${userLng})`);
        console.log('ì¬ë°°ì¹˜ ì „ ìˆ™ì†Œ ìœ„ì¹˜ë“¤:', accommodations.map(acc => ({ title: acc.title, lat: acc.lat, lng: acc.lng })));

        // ì§€ë„ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ bounds ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ ë°˜ê²½ ì‚¬ìš©
        let latRange, lngRange, bounds;

        if (map && map.getBounds) {
          try {
            bounds = map.getBounds();
            // ì§€ë„ ì¤‘ì‹¬ì—ì„œ ë³´ì´ëŠ” ë²”ìœ„ì˜ 80% ë‚´ì—ì„œ ë§ˆì»¤ ë°°ì¹˜
            latRange = (bounds.getNorthEast().getLat() - bounds.getSouthWest().getLat()) * 0.4;
            lngRange = (bounds.getNorthEast().getLng() - bounds.getSouthWest().getLng()) * 0.4;

            console.log('ì§€ë„ bounds ê¸°ë°˜ ë°°ì¹˜:', {
              latRange: latRange.toFixed(6),
              lngRange: lngRange.toFixed(6),
              bounds: {
                sw: `(${bounds.getSouthWest().getLat().toFixed(6)}, ${bounds.getSouthWest().getLng().toFixed(6)})`,
                ne: `(${bounds.getNorthEast().getLat().toFixed(6)}, ${bounds.getNorthEast().getLng().toFixed(6)})`
              }
            });
          } catch (error) {
            console.warn('ì§€ë„ bounds ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨, ê¸°ë³¸ ë°˜ê²½ ì‚¬ìš©:', error);
            latRange = 0.02; // ê¸°ë³¸ ë°˜ê²½
            lngRange = 0.02;
          }
        } else {
          console.log('ì§€ë„ ê°ì²´ ì—†ìŒ, ê¸°ë³¸ ë°˜ê²½ ì‚¬ìš©');
          latRange = 0.02; // ê¸°ë³¸ ë°˜ê²½
          lngRange = 0.02;
        }

        const minDistance = Math.min(latRange, lngRange) * 0.2; // ë§ˆì»¤ ê°„ ìµœì†Œ ê±°ë¦¬
        const usedPositions = []; // ì´ë¯¸ ì‚¬ìš©ëœ ìœ„ì¹˜ë“¤

        accommodations.forEach((accommodation, index) => {
          let newLat, newLng, attempts = 0;
          let validPosition = false;

          // ë³´ì´ëŠ” ë²”ìœ„ ë‚´ì—ì„œ ê²¹ì¹˜ì§€ ì•ŠëŠ” ìœ„ì¹˜ ì°¾ê¸°
          while (!validPosition && attempts < 30) {
            // ì‚¬ìš©ì ìœ„ì¹˜ ì¤‘ì‹¬ìœ¼ë¡œ ë²”ìœ„ ë‚´ì—ì„œ ëœë¤ ë°°ì¹˜
            const randomLatOffset = (Math.random() - 0.5) * latRange * 2;
            const randomLngOffset = (Math.random() - 0.5) * lngRange * 2;

            newLat = userLat + randomLatOffset;
            newLng = userLng + randomLngOffset;

            // ì§€ë„ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸ (boundsê°€ ìˆëŠ” ê²½ìš°)
            let withinBounds = true;
            if (bounds) {
              withinBounds = newLat >= bounds.getSouthWest().getLat() &&
                newLat <= bounds.getNorthEast().getLat() &&
                newLng >= bounds.getSouthWest().getLng() &&
                newLng <= bounds.getNorthEast().getLng();
            }

            // ë‹¤ë¥¸ ë§ˆì»¤ë“¤ê³¼ì˜ ê±°ë¦¬ í™•ì¸
            const tooClose = usedPositions.some(pos => {
              const distance = Math.sqrt(
                Math.pow(newLat - pos.lat, 2) + Math.pow(newLng - pos.lng, 2)
              );
              return distance < minDistance;
            });

            if (withinBounds && !tooClose) {
              validPosition = true;
            }

            attempts++;
          }

          // ì ì ˆí•œ ìœ„ì¹˜ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš° ê°•ì œë¡œ ì›í˜• ë°°ì¹˜
          if (!validPosition) {
            console.warn(`${accommodation.title}: ì ì ˆí•œ ìœ„ì¹˜ë¥¼ ì°¾ì§€ ëª»í•´ ì›í˜• ë°°ì¹˜ ì‚¬ìš©`);
            const angle = (index * Math.PI * 2) / accommodations.length;
            const distance = Math.min(latRange, lngRange) * 0.6;
            newLat = userLat + Math.cos(angle) * distance;
            newLng = userLng + Math.sin(angle) * distance;
          }

          const oldLat = accommodation.lat;
          const oldLng = accommodation.lng;

          accommodation.lat = newLat;
          accommodation.lng = newLng;

          // ì‚¬ìš©ëœ ìœ„ì¹˜ì— ì¶”ê°€
          usedPositions.push({ lat: newLat, lng: newLng });

          console.log(`${accommodation.title}: (${oldLat.toFixed(6)}, ${oldLng.toFixed(6)}) â†’ (${accommodation.lat.toFixed(6)}, ${accommodation.lng.toFixed(6)}) [ì‹œë„: ${attempts}íšŒ]`);
        });

        console.log('ì¬ë°°ì¹˜ í›„ ìˆ™ì†Œ ìœ„ì¹˜ë“¤:', accommodations.map(acc => ({ title: acc.title, lat: acc.lat.toFixed(6), lng: acc.lng.toFixed(6) })));
        console.log('ì‚¬ìš©ì ìœ„ì¹˜ ì£¼ë³€ìœ¼ë¡œ ìˆ™ì†Œ ì¬ë°°ì¹˜ ì™„ë£Œ');
      }

      // ê¸°ì¡´ ë§ˆì»¤ ëª¨ë‘ ì œê±°
      function clearAllMarkers() {
        console.log(`ê¸°ì¡´ ë§ˆì»¤ ${mapMarkers.length}ê°œ ì œê±° ì‹œì‘`);

        mapMarkers.forEach((marker, index) => {
          try {
            if (marker && marker.setMap) {
              marker.setMap(null);
              console.log(`ë§ˆì»¤ ${index + 1} ì œê±°ë¨`);
            }
          } catch (error) {
            console.error(`ë§ˆì»¤ ${index + 1} ì œê±° ì¤‘ ì˜¤ë¥˜:`, error);
          }
        });

        mapMarkers.length = 0; // ë°°ì—´ ì™„ì „íˆ ë¹„ìš°ê¸°
        console.log('ê¸°ì¡´ ë§ˆì»¤ ëª¨ë‘ ì œê±° ì™„ë£Œ. mapMarkers ê¸¸ì´:', mapMarkers.length);
      }

      // ì§€ë„ ì´ˆê¸°í™”
      async function initMap() {
        const container = document.getElementById('map');
        let centerLat = 37.8315; // ê¸°ë³¸ ê°€í‰ ì¢Œí‘œ
        let centerLng = 127.5109;
        let mapLevel = 5;

        // ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ì¸ì§€ í™•ì¸
        if (isLocationBasedAccess()) {
          try {
            console.log('ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ ê°ì§€ - ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ëŠ” ì¤‘...');

            // ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
            userLocation = await getUserLocation();
            centerLat = userLocation.lat;
            centerLng = userLocation.lng;
            mapLevel = 4; // ì¡°ê¸ˆ ë” í™•ëŒ€

            console.log(`ì§€ë„ ì¤‘ì‹¬ì„ ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ì„¤ì •: (${centerLat}, ${centerLng})`);

            // ì‚¬ìš©ìì—ê²Œ ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤ ì‹œì‘ì„ ì•Œë¦¼
            showLocationNotification('í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ì£¼ë³€ ìˆ™ì†Œë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.');

          } catch (error) {
            console.error('ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);

            // ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ëŠ” ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            showLocationNotification('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì–´ ê¸°ë³¸ ì§€ì—­(ê°€í‰)ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.', 'warning');
          }
        }

        const options = {
          center: new kakao.maps.LatLng(centerLat, centerLng),
          level: mapLevel
        };

        map = new kakao.maps.Map(container, options);

        // ì‚¬ìš©ì ìœ„ì¹˜ê°€ ìˆëŠ” ê²½ìš° ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€
        if (userLocation) {
          addUserLocationMarker(userLocation.lat, userLocation.lng);
        }

        // ì§€ë„ ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸
        setupMapControls();

        // ì§€ë„ ë¡œë”© ì™„ë£Œ í›„ ë§ˆì»¤ ì¬ë°°ì¹˜ ë° ìƒì„±
        setTimeout(() => {
          // ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ì¸ ê²½ìš° ë§ˆì»¤ ì¬ë°°ì¹˜
          if (userLocation) {
            relocateAccommodationsNearUser(userLocation.lat, userLocation.lng);
          }

          // ë§ˆì»¤ ìƒì„±
          createMarkers();
        }, 800); // ì§€ì—° ì‹œê°„ ì¦ê°€

        console.log('ì¹´ì¹´ì˜¤ ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
      }

      // ë§ˆì»¤ ìƒì„± í•¨ìˆ˜
      function createMarkers() {
        console.log('=== ë§ˆì»¤ ìƒì„± ì‹œì‘ ===');

        accommodations.forEach((accommodation, index) => {
          console.log(`ë§ˆì»¤ ${index + 1} ìƒì„± ì¤‘:`, accommodation.title, `ìœ„ì¹˜: (${accommodation.lat.toFixed(6)}, ${accommodation.lng.toFixed(6)})`);

          try {
            // ì»¤ìŠ¤í…€ ë§ˆì»¤ HTML ìƒì„±
            const markerContent = `
              <div class="relative marker-${index}" data-accommodation-id="${accommodation.id}">
                <div class="w-[90px] h-[36px] flex items-center justify-center bg-primary text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 cursor-pointer marker-clickable">
                  <span class="text-sm font-medium">${accommodation.price}</span>
                </div>
              </div>
            `;

            // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ ìƒì„±
            const customOverlay = new kakao.maps.CustomOverlay({
              position: new kakao.maps.LatLng(accommodation.lat, accommodation.lng),
              content: markerContent,
              yAnchor: 0.5,
              zIndex: 100 + index // z-indexë¡œ ê²¹ì¹¨ ë°©ì§€
            });

            // ì§€ë„ì— ë§ˆì»¤ ì¶”ê°€
            customOverlay.setMap(map);

            // ë§ˆì»¤ê°€ ì‹¤ì œë¡œ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (customOverlay.getMap()) {
              console.log(`âœ… ë§ˆì»¤ ${index + 1} (${accommodation.title}) ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë¨`);
            } else {
              console.error(`âŒ ë§ˆì»¤ ${index + 1} (${accommodation.title}) ì¶”ê°€ ì‹¤íŒ¨`);
            }

            // ì§€ì—° í›„ ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”© (DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„)
            setTimeout(() => {
              const markerElement = document.querySelector(`.marker-${index}`);
              console.log(`ë§ˆì»¤ ${index + 1} DOM ìš”ì†Œ ì°¾ê¸°:`, markerElement ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');

              if (markerElement) {
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                markerElement.removeEventListener('click', markerElement.clickHandler);

                // ìƒˆë¡œìš´ í´ë¦­ í•¸ë“¤ëŸ¬ ì •ì˜
                markerElement.clickHandler = function (event) {
                  console.log(`ğŸ¯ ë§ˆì»¤ ${index + 1} í´ë¦­ë¨: ${accommodation.title}`);
                  console.log(`í´ë¦­í•œ ë§ˆì»¤ ìœ„ì¹˜: (${accommodation.lat.toFixed(6)}, ${accommodation.lng.toFixed(6)})`);

                  // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
                  event.stopPropagation();
                  event.preventDefault();

                  // ë‹¤ë¥¸ íŒì—…ì´ ì—´ë ¤ìˆìœ¼ë©´ ë¨¼ì € ë‹«ê¸°
                  const existingPopup = document.getElementById('infoPopup');
                  if (existingPopup && !existingPopup.classList.contains('hidden')) {
                    existingPopup.classList.add('hidden');
                  }

                  console.log('showAccommodationPopup í˜¸ì¶œ ì‹œì‘');

                  // ì‹¤ì œ í´ë¦­í•œ í™”ë©´ ì¢Œí‘œ ì‚¬ìš© (ê°€ì¥ ì •í™•í•œ ë°©ë²•)
                  const mapContainer = document.getElementById('map');
                  const mapRect = mapContainer.getBoundingClientRect();

                  // í´ë¦­í•œ í™”ë©´ ì¢Œí‘œë¥¼ ì§€ë„ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ ìƒëŒ€ ì¢Œí‘œë¡œ ë³€í™˜
                  const clickPosition = {
                    x: event.clientX - mapRect.left,
                    y: event.clientY - mapRect.top
                  };

                  console.log('ì‹¤ì œ í´ë¦­ ìœ„ì¹˜ ê³„ì‚°:', {
                    clientX: event.clientX,
                    clientY: event.clientY,
                    mapRect: {
                      left: mapRect.left,
                      top: mapRect.top,
                      width: mapRect.width,
                      height: mapRect.height
                    },
                    relative: clickPosition
                  });

                  // í´ë¦­ ìœ„ì¹˜ê°€ ì§€ë„ ì˜ì—­ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
                  if (clickPosition.x >= 0 && clickPosition.x <= mapRect.width &&
                    clickPosition.y >= 0 && clickPosition.y <= mapRect.height) {
                    console.log('âœ… í´ë¦­ ìœ„ì¹˜ê°€ ì§€ë„ ì˜ì—­ ë‚´ì— ìˆìŒ');
                  } else {
                    console.log('âš ï¸ í´ë¦­ ìœ„ì¹˜ê°€ ì§€ë„ ì˜ì—­ì„ ë²—ì–´ë‚¨');
                  }

                  // ìˆ™ì†Œ ì •ë³´ì™€ í•¨ê»˜ í´ë¦­ ìœ„ì¹˜ë„ ì „ë‹¬
                  showAccommodationPopup(accommodation, clickPosition);
                };

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                markerElement.addEventListener('click', markerElement.clickHandler);

                // ì¶”ê°€ í™•ì¸ì„ ìœ„í•´ hover ì´ë²¤íŠ¸ë„ ì¶”ê°€
                markerElement.addEventListener('mouseenter', function () {
                  console.log(`ë§ˆì»¤ ${index + 1} í˜¸ë²„: ${accommodation.title}`);
                });

                console.log(`âœ… ë§ˆì»¤ ${index + 1} í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”© ì™„ë£Œ`);
              } else {
                console.error(`âŒ ë§ˆì»¤ ${index + 1} DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
              }
            }, 100); // 100ms ì§€ì—°

            mapMarkers.push(customOverlay);

          } catch (error) {
            console.error(`ë§ˆì»¤ ${index + 1} ìƒì„± ì¤‘ ì˜¤ë¥˜:`, error);
          }
        });

        console.log(`ì´ ${accommodations.length}ê°œì˜ ë§ˆì»¤ ìƒì„± ì™„ë£Œ`);
        console.log(`mapMarkers ë°°ì—´ ê¸¸ì´: ${mapMarkers.length}`);
        console.log('í˜„ì¬ ì§€ë„ ì¤‘ì‹¬:', map.getCenter().getLat().toFixed(6), map.getCenter().getLng().toFixed(6));
        console.log('í˜„ì¬ ì§€ë„ ë ˆë²¨:', map.getLevel());

        // ì§€ë„ ë²”ìœ„ í™•ì¸
        const bounds = map.getBounds();
        console.log('ì§€ë„ ë²”ìœ„:', {
          sw: `(${bounds.getSouthWest().getLat().toFixed(6)}, ${bounds.getSouthWest().getLng().toFixed(6)})`,
          ne: `(${bounds.getNorthEast().getLat().toFixed(6)}, ${bounds.getNorthEast().getLng().toFixed(6)})`
        });

        console.log('=== ë§ˆì»¤ ìƒì„± ì™„ë£Œ ===');
      }

      // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€
      function addUserLocationMarker(lat, lng) {
        const userMarkerContent = `
          <div class="relative">
            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-pulse">
              <i class="ri-user-location-line text-white text-lg"></i>
            </div>
            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-blue-600 rounded-full border-2 border-white"></div>
          </div>
        `;

        const userMarker = new kakao.maps.CustomOverlay({
          position: new kakao.maps.LatLng(lat, lng),
          content: userMarkerContent,
          yAnchor: 0.5,
          zIndex: 10 // ë‹¤ë¥¸ ë§ˆì»¤ë³´ë‹¤ ìœ„ì— í‘œì‹œ
        });

        userMarker.setMap(map);
        console.log('ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€ë¨');
      }

      // ìœ„ì¹˜ ì•Œë¦¼ í‘œì‹œ
      function showLocationNotification(message, type = 'info') {
        const notification = document.createElement('div');
        const bgColor = type === 'warning' ? 'bg-yellow-100 border-yellow-400 text-yellow-700' : 'bg-blue-100 border-blue-400 text-blue-700';

        notification.className = `fixed top-20 left-4 right-4 ${bgColor} border px-4 py-3 rounded-lg shadow-lg z-50 animate-fadeIn`;
        notification.innerHTML = `
          <div class="flex items-center gap-2">
            <i class="ri-information-line text-lg"></i>
            <span class="text-sm">${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-auto">
              <i class="ri-close-line text-lg"></i>
            </button>
          </div>
        `;

        document.body.appendChild(notification);

        // 5ì´ˆ í›„ ìë™ ì œê±°
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 5000);
      }

      // ìˆ™ì†Œ ì •ë³´ íŒì—… í‘œì‹œ
      function showAccommodationPopup(accommodation, clickPosition) {
        console.log('ğŸ”¥ showAccommodationPopup í•¨ìˆ˜ í˜¸ì¶œë¨:', accommodation.title);
        console.log('ì „ë‹¬ë°›ì€ í´ë¦­ ìœ„ì¹˜:', clickPosition);

        const popup = document.getElementById('infoPopup');
        const popupImage = document.getElementById('popupImage');
        const popupTitle = document.getElementById('popupTitle');
        const popupRating = document.getElementById('popupRating');
        const popupReviews = document.getElementById('popupReviews');
        const popupPrice = document.getElementById('popupPrice');
        const popupDetailBtn = document.getElementById('popupDetailBtn');

        console.log('íŒì—… DOM ìš”ì†Œë“¤ í™•ì¸:', {
          popup: popup ? 'âœ…' : 'âŒ',
          popupImage: popupImage ? 'âœ…' : 'âŒ',
          popupTitle: popupTitle ? 'âœ…' : 'âŒ',
          popupRating: popupRating ? 'âœ…' : 'âŒ',
          popupReviews: popupReviews ? 'âœ…' : 'âŒ',
          popupPrice: popupPrice ? 'âœ…' : 'âŒ',
          popupDetailBtn: popupDetailBtn ? 'âœ…' : 'âŒ'
        });

        if (!popup) {
          console.error('âŒ íŒì—… ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
          return;
        }

        try {
          // íŒì—… ë‚´ìš© ì—…ë°ì´íŠ¸
          console.log('íŒì—… ë‚´ìš© ì—…ë°ì´íŠ¸ ì‹œì‘...');

          if (popupImage) {
            popupImage.src = accommodation.image;
            console.log('ì´ë¯¸ì§€ URL ì„¤ì •:', accommodation.image);
          }

          if (popupTitle) {
            popupTitle.textContent = accommodation.title;
            console.log('ì œëª© ì„¤ì •:', accommodation.title);
          }

          if (popupRating) {
            popupRating.textContent = accommodation.rating;
            console.log('í‰ì  ì„¤ì •:', accommodation.rating);
          }

          if (popupReviews) {
            popupReviews.textContent = accommodation.reviews;
            console.log('ë¦¬ë·° ì„¤ì •:', accommodation.reviews);
          }

          if (popupPrice) {
            popupPrice.textContent = accommodation.price;
            console.log('ê°€ê²© ì„¤ì •:', accommodation.price);
          }

          // ìƒì„¸ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
          if (popupDetailBtn) {
            popupDetailBtn.onclick = function () {
              console.log('ìƒì„¸ë³´ê¸° ë²„íŠ¼ í´ë¦­ë¨');
              // shop_detail.htmlë¡œ ì´ë™ (ìˆ™ì†Œ ì •ë³´ ì „ë‹¬)
              const params = new URLSearchParams();
              params.append('title', accommodation.title);
              params.append('price', accommodation.price.replace(/[â‚©,]/g, ''));
              params.append('rating', accommodation.rating);
              params.append('image', accommodation.image);
              params.append('type', accommodation.type);

              window.location.href = `shop_detail.html?${params.toString()}`;
            };
          }

          // íŒì—… ìœ„ì¹˜ ê³„ì‚° - í´ë¦­ ìœ„ì¹˜ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì‚¬ìš©
          const mapContainer = document.getElementById('map');

          console.log('ì§€ë„ ì»¨í…Œì´ë„ˆ ì •ë³´:', {
            width: mapContainer.offsetWidth,
            height: mapContainer.offsetHeight
          });

          // íŒì—… í¬ê¸° (ê³ ì •)
          const popupWidth = 280;
          const popupHeight = 200;

          let popupX, popupY;

          // í´ë¦­ ìœ„ì¹˜ê°€ ì „ë‹¬ëœ ê²½ìš° ì´ë¥¼ ì§ì ‘ ì‚¬ìš© (ì§€ë„ ì»¨í…Œì´ë„ˆ ê¸°ì¤€)
          if (clickPosition) {
            console.log('âœ… ì‹¤ì œ í´ë¦­ ìœ„ì¹˜ ì‚¬ìš©:', clickPosition);

            // í´ë¦­ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ íŒì—… ë°°ì¹˜
            popupX = clickPosition.x + 15; // í´ë¦­ ìœ„ì¹˜ì—ì„œ 15px ì˜¤ë¥¸ìª½
            popupY = clickPosition.y - (popupHeight / 2); // í´ë¦­ ìœ„ì¹˜ë¥¼ íŒì—… ì¤‘ì•™ì— ë§ì¶¤

            console.log('ì´ˆê¸° íŒì—… ìœ„ì¹˜:', `(${popupX}, ${popupY})`);

            // ì§€ë„ ì»¨í…Œì´ë„ˆ ê²½ê³„ ì²´í¬ ë° ì¡°ì •
            const mapWidth = mapContainer.offsetWidth;
            const mapHeight = mapContainer.offsetHeight;

            // ì˜¤ë¥¸ìª½ ê²½ê³„ ì²´í¬
            if (popupX + popupWidth > mapWidth) {
              popupX = clickPosition.x - popupWidth - 15; // í´ë¦­ ìœ„ì¹˜ ì™¼ìª½ì— ë°°ì¹˜
              console.log('íŒì—…ì„ í´ë¦­ ìœ„ì¹˜ ì™¼ìª½ì— ë°°ì¹˜');
            }

            // ìœ„ìª½ ê²½ê³„ ì²´í¬
            if (popupY < 0) {
              popupY = 10;
              console.log('íŒì—…ì„ ìœ„ìª½ ê²½ê³„ì— ë§ì¶¤');
            }

            // ì•„ë˜ìª½ ê²½ê³„ ì²´í¬
            if (popupY + popupHeight > mapHeight) {
              popupY = mapHeight - popupHeight - 10;
              console.log('íŒì—…ì„ ì•„ë˜ìª½ ê²½ê³„ì— ë§ì¶¤');
            }

            // ì™¼ìª½ ê²½ê³„ ì²´í¬ (íŒì—…ì´ ì™¼ìª½ìœ¼ë¡œ ì´ë™í–ˆì„ ë•Œ)
            if (popupX < 0) {
              popupX = 10;
              popupY = clickPosition.y + 15; // í´ë¦­ ìœ„ì¹˜ ì•„ë˜ìª½ì— ë°°ì¹˜

              // ì•„ë˜ìª½ìœ¼ë¡œ ì´ë™ í›„ ë‹¤ì‹œ ê²½ê³„ ì²´í¬
              if (popupY + popupHeight > mapHeight) {
                popupY = clickPosition.y - popupHeight - 15; // í´ë¦­ ìœ„ì¹˜ ìœ„ìª½ì— ë°°ì¹˜
              }
              console.log('íŒì—…ì„ í´ë¦­ ìœ„ì¹˜ ì•„ë˜ìª½/ìœ„ìª½ì— ë°°ì¹˜');
            }

          } else {
            console.log('âŒ í´ë¦­ ìœ„ì¹˜ê°€ ì—†ì–´ì„œ ì¤‘ì•™ ë°°ì¹˜');
            // í´ë¦­ ìœ„ì¹˜ê°€ ì—†ëŠ” ê²½ìš° ì§€ë„ ì¤‘ì•™ì— ë°°ì¹˜
            popupX = (mapContainer.offsetWidth - popupWidth) / 2;
            popupY = (mapContainer.offsetHeight - popupHeight) / 2;
          }

          console.log(`ğŸ¯ ìµœì¢… íŒì—… ìœ„ì¹˜: (${popupX}, ${popupY})`);
          console.log(`ğŸ¯ í´ë¦­ ìœ„ì¹˜: (${clickPosition ? clickPosition.x : 'N/A'}, ${clickPosition ? clickPosition.y : 'N/A'})`);

          if (clickPosition) {
            const distanceX = Math.abs(popupX - clickPosition.x);
            const distanceY = Math.abs(popupY + popupHeight / 2 - clickPosition.y);
            console.log(`ğŸ¯ íŒì—…ê³¼ í´ë¦­ ìœ„ì¹˜ì˜ ê±°ë¦¬: X=${distanceX}px, Y=${distanceY}px`);
          }

          // íŒì—… ìœ„ì¹˜ ì„¤ì • (ì§€ë„ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ ì ˆëŒ€ ìœ„ì¹˜)
          console.log('íŒì—… ìŠ¤íƒ€ì¼ ì„¤ì • ì¤‘...');
          popup.style.left = `${popupX}px`;
          popup.style.top = `${popupY}px`;
          popup.style.position = 'absolute';

          // íŒì—… í‘œì‹œ
          console.log('íŒì—… í‘œì‹œ ì¤‘...');
          popup.classList.remove('hidden');

          // í‘œì‹œ í™•ì¸
          setTimeout(() => {
            const isVisible = !popup.classList.contains('hidden');
            console.log('íŒì—… í‘œì‹œ ìƒíƒœ í™•ì¸:', isVisible ? 'âœ… í‘œì‹œë¨' : 'âŒ ìˆ¨ê²¨ì§');

            if (isVisible) {
              const computedStyle = window.getComputedStyle(popup);
              console.log('íŒì—… computed ìŠ¤íƒ€ì¼:', {
                display: computedStyle.display,
                visibility: computedStyle.visibility,
                opacity: computedStyle.opacity,
                left: computedStyle.left,
                top: computedStyle.top,
                zIndex: computedStyle.zIndex
              });
            }
          }, 50);

          console.log('âœ… ìˆ™ì†Œ íŒì—… í‘œì‹œ ì™„ë£Œ:', accommodation.title, `ìœ„ì¹˜: (${popupX}, ${popupY})`);

        } catch (error) {
          console.error('âŒ íŒì—… í‘œì‹œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        }
      }

      // ì§€ë„ ì»¨íŠ¸ë¡¤ ì„¤ì •
      function setupMapControls() {
        const zoomInBtn = document.getElementById('zoomIn');
        const zoomOutBtn = document.getElementById('zoomOut');
        const currentLocationBtn = document.getElementById('currentLocation');
        const closePopup = document.getElementById('closePopup');

        // í™•ëŒ€
        zoomInBtn.addEventListener('click', function () {
          if (map) {
            const level = map.getLevel();
            if (level > 1) {
              map.setLevel(level - 1);
              showLocationNotification('ì§€ë„ê°€ í™•ëŒ€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
              showLocationNotification('ìµœëŒ€ í™•ëŒ€ ìˆ˜ì¤€ì…ë‹ˆë‹¤.', 'warning');
            }
          }
        });

        // ì¶•ì†Œ
        zoomOutBtn.addEventListener('click', function () {
          if (map) {
            const level = map.getLevel();
            if (level < 14) {
              map.setLevel(level + 1);
              showLocationNotification('ì§€ë„ê°€ ì¶•ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
              showLocationNotification('ìµœëŒ€ ì¶•ì†Œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.', 'warning');
            }
          }
        });

        // í˜„ì¬ ìœ„ì¹˜ ì´ë™
        currentLocationBtn.addEventListener('click', async function () {
          try {
            // ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ê·¸ ìœ„ì¹˜ë¡œ ì´ë™
            if (userLocation) {
              const moveLatLng = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
              map.setCenter(moveLatLng); // ì§€ë„ ì¤‘ì‹¬ì„ ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ì„¤ì •
              map.setLevel(4); // ì ì ˆí•œ ì¤Œ ë ˆë²¨ë¡œ ì„¤ì •
              showLocationNotification('í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.');
            } else {
              // ì‚¬ìš©ì ìœ„ì¹˜ê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ê°€ì ¸ì˜¤ê¸°
              showLocationNotification('í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...', 'info');

              userLocation = await getUserLocation();
              const moveLatLng = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
              map.setCenter(moveLatLng); // ì§€ë„ ì¤‘ì‹¬ì„ ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ì„¤ì •
              map.setLevel(4); // ì ì ˆí•œ ì¤Œ ë ˆë²¨ë¡œ ì„¤ì •

              // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€ (ì•„ì§ ì—†ëŠ” ê²½ìš°)
              addUserLocationMarker(userLocation.lat, userLocation.lng);

              // ìˆ™ì†Œ ìœ„ì¹˜ ì¬ë°°ì¹˜
              relocateAccommodationsNearUser(userLocation.lat, userLocation.lng);

              // ê¸°ì¡´ ë§ˆì»¤ ì œê±° í›„ ì¬ìƒì„±
              clearAllMarkers(); // ê¸°ì¡´ ë§ˆì»¤ ëª¨ë‘ ì œê±°
              createMarkers(); // ìƒˆë¡œìš´ ë§ˆì»¤ ìƒì„±

              showLocationNotification('í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í•˜ê³  ì£¼ë³€ ìˆ™ì†Œë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.');
            }
          } catch (error) {
            console.error('í˜„ì¬ ìœ„ì¹˜ ì´ë™ ì‹¤íŒ¨:', error);
            // ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ê°€í‰ ìœ„ì¹˜ë¡œ ì´ë™
            const moveLatLng = new kakao.maps.LatLng(37.8315, 127.5109);
            map.setCenter(moveLatLng); // ì§€ë„ ì¤‘ì‹¬ì„ ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì„¤ì •
            map.setLevel(5);
            showLocationNotification('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì–´ ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.', 'warning');
          }
        });

        // íŒì—… ë‹«ê¸°
        closePopup.addEventListener('click', function () {
          const popup = document.getElementById('infoPopup');
          popup.classList.add('hidden');
          console.log('íŒì—… ë‹«í˜');
        });

        // íŒì—… ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('infoPopup').addEventListener('click', function (e) {
          if (e.target === this) {
            this.classList.add('hidden');
            console.log('íŒì—… ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ë‹«í˜');
          }
        });

        // ì§€ë„ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
        if (map) {
          kakao.maps.event.addListener(map, 'click', function () {
            const popup = document.getElementById('infoPopup');
            if (!popup.classList.contains('hidden')) {
              popup.classList.add('hidden');
              console.log('ì§€ë„ í´ë¦­ìœ¼ë¡œ íŒì—… ë‹«í˜');
            }
          });
        }
      }

      // ì¹´ì¹´ì˜¤ ì§€ë„ API ë¡œë“œ í™•ì¸ í›„ ì§€ë„ ì´ˆê¸°í™”
      if (typeof kakao !== 'undefined' && kakao.maps) {
        kakao.maps.load(function () {
          initMap();
        });
      } else {
        console.error('ì¹´ì¹´ì˜¤ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
        // API í‚¤ê°€ ì—†ëŠ” ê²½ìš° ëŒ€ì²´ ì§€ë„ í‘œì‹œ
        document.getElementById('map').innerHTML = `
          <div class="w-full h-full flex items-center justify-center bg-gray-100 text-gray-500 rounded-xl">
            <div class="text-center">
              <i class="ri-map-2-line text-4xl mb-2"></i>
              <p>ì¹´ì¹´ì˜¤ ì§€ë„ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤</p>
              <p class="text-sm">ì‹¤ì œ êµ¬í˜„ ì‹œ ìœ íš¨í•œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            </div>
          </div>
        `;

        // ëŒ€ì²´ ë§ˆì»¤ í‘œì‹œ (ê¸°ì¡´ ë°©ì‹)
        createFallbackMarkers();
      }

      // ëŒ€ì²´ ë§ˆì»¤ ìƒì„± (API í‚¤ê°€ ì—†ì„ ë•Œ)
      function createFallbackMarkers() {
        console.log('ğŸ”„ ëŒ€ì²´ ë§ˆì»¤ ìƒì„± ì‹œì‘');

        const mapContainer = document.getElementById('map');
        mapContainer.style.position = 'relative';
        mapContainer.style.backgroundImage = 'url(https://public.readdy.ai/gen_page/map_placeholder_1280x720.png)';
        mapContainer.style.backgroundSize = 'cover';
        mapContainer.style.backgroundPosition = 'center';

        // ëŒ€ì²´ ì§€ë„ìš© ë³€ìˆ˜ë“¤
        let fallbackZoomLevel = 1;
        let fallbackCenterX = 50;
        let fallbackCenterY = 50;

        // ëŒ€ì²´ ì§€ë„ ì»¨íŠ¸ë¡¤ ê¸°ëŠ¥
        const zoomInBtn = document.getElementById('zoomIn');
        const zoomOutBtn = document.getElementById('zoomOut');
        const currentLocationBtn = document.getElementById('currentLocation');

        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        zoomInBtn.removeEventListener('click', zoomInBtn.fallbackZoomInHandler);
        zoomOutBtn.removeEventListener('click', zoomOutBtn.fallbackZoomOutHandler);
        currentLocationBtn.removeEventListener('click', currentLocationBtn.fallbackLocationHandler);

        // í™•ëŒ€ ê¸°ëŠ¥
        zoomInBtn.fallbackZoomInHandler = function () {
          if (fallbackZoomLevel < 3) {
            fallbackZoomLevel += 0.5;
            updateFallbackMap();
            showLocationNotification('ì§€ë„ê°€ í™•ëŒ€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
        };
        zoomInBtn.addEventListener('click', zoomInBtn.fallbackZoomInHandler);

        // ì¶•ì†Œ ê¸°ëŠ¥
        zoomOutBtn.fallbackZoomOutHandler = function () {
          if (fallbackZoomLevel > 0.5) {
            fallbackZoomLevel -= 0.5;
            updateFallbackMap();
            showLocationNotification('ì§€ë„ê°€ ì¶•ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
        };
        zoomOutBtn.addEventListener('click', zoomOutBtn.fallbackZoomOutHandler);

        // í˜„ì¬ ìœ„ì¹˜ ì´ë™ ê¸°ëŠ¥
        currentLocationBtn.fallbackLocationHandler = async function () {
          try {
            console.log('í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ í´ë¦­ë¨');
            showLocationNotification('í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...', 'info');

            // ê°„ë‹¨í•œ geolocation API ì‚¬ìš©
            const position = await new Promise((resolve, reject) => {
              if (!navigator.geolocation) {
                reject(new Error('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'));
                return;
              }

              navigator.geolocation.getCurrentPosition(
                (pos) => {
                  resolve({
                    lat: pos.coords.latitude,
                    lng: pos.coords.longitude,
                    accuracy: pos.coords.accuracy
                  });
                },
                (error) => {
                  let errorMessage = '';
                  switch (error.code) {
                    case error.PERMISSION_DENIED:
                      errorMessage = 'ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                      break;
                    case error.POSITION_UNAVAILABLE:
                      errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                      break;
                    case error.TIMEOUT:
                      errorMessage = 'ìœ„ì¹˜ ì •ë³´ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                      break;
                    default:
                      errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                      break;
                  }
                  reject(new Error(errorMessage));
                },
                {
                  enableHighAccuracy: true,
                  timeout: 10000,
                  maximumAge: 300000
                }
              );
            });

            console.log('ì‚¬ìš©ì ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ì„±ê³µ:', position);
            userLocation = position;

            // ì‚¬ìš©ì ìœ„ì¹˜ë¥¼ ì§€ë„ ì¤‘ì•™ìœ¼ë¡œ ì„¤ì •
            fallbackCenterX = 50;
            fallbackCenterY = 50;
            fallbackZoomLevel = 1.5;

            updateFallbackMap();

            // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€
            addFallbackUserLocationMarker();

            showLocationNotification('í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.');
          } catch (error) {
            console.error('í˜„ì¬ ìœ„ì¹˜ ì´ë™ ì‹¤íŒ¨:', error);
            showLocationNotification(error.message, 'warning');
          }
        };
        currentLocationBtn.addEventListener('click', currentLocationBtn.fallbackLocationHandler);

        // ëŒ€ì²´ ì§€ë„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateFallbackMap() {
          console.log('ëŒ€ì²´ ì§€ë„ ì—…ë°ì´íŠ¸:', { fallbackZoomLevel, fallbackCenterX, fallbackCenterY });
          mapContainer.style.transform = `scale(${fallbackZoomLevel})`;
          mapContainer.style.transformOrigin = `${fallbackCenterX}% ${fallbackCenterY}%`;
        }

        // ëŒ€ì²´ ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€
        function addFallbackUserLocationMarker() {
          console.log('ëŒ€ì²´ ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€');

          // ê¸°ì¡´ ì‚¬ìš©ì ë§ˆì»¤ ì œê±°
          const existingUserMarker = document.querySelector('.fallback-user-marker');
          if (existingUserMarker) {
            existingUserMarker.remove();
          }

          // ìƒˆë¡œìš´ ì‚¬ìš©ì ë§ˆì»¤ ìƒì„±
          const userMarkerDiv = document.createElement('div');
          userMarkerDiv.className = 'absolute fallback-user-marker';
          userMarkerDiv.style.top = '50%';
          userMarkerDiv.style.left = '50%';
          userMarkerDiv.style.transform = 'translate(-50%, -50%)';
          userMarkerDiv.style.zIndex = '1000';

          userMarkerDiv.innerHTML = `
            <div class="relative">
              <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-pulse">
                <i class="ri-user-location-line text-white text-lg"></i>
              </div>
              <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-blue-600 rounded-full border-2 border-white"></div>
            </div>
          `;

          mapContainer.appendChild(userMarkerDiv);
          console.log('ëŒ€ì²´ ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€ ì™„ë£Œ');
        }

        accommodations.forEach((accommodation, index) => {
          console.log(`ëŒ€ì²´ ë§ˆì»¤ ${index + 1} ìƒì„± ì¤‘: ${accommodation.title}`);

          const markerDiv = document.createElement('div');
          markerDiv.className = `absolute cursor-pointer marker-fallback-${index}`;
          markerDiv.setAttribute('data-accommodation-id', accommodation.id);

          // ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ì¸ ê²½ìš° ë” ì¤‘ì•™ì— ë°°ì¹˜
          let topPercent, leftPercent;
          if (userLocation) {
            // ì‚¬ìš©ì ìœ„ì¹˜ê°€ ìˆëŠ” ê²½ìš° ì¤‘ì•™ ê·¼ì²˜ì— ë°°ì¹˜
            topPercent = 40 + index * 8;
            leftPercent = 35 + (index % 3) * 10;
          } else {
            // ê¸°ë³¸ ë°°ì¹˜
            topPercent = 20 + index * 15;
            leftPercent = 20 + (index % 3) * 20;
          }

          markerDiv.style.top = `${topPercent}%`;
          markerDiv.style.left = `${leftPercent}%`;

          console.log(`ëŒ€ì²´ ë§ˆì»¤ ${index + 1} (${accommodation.title}): ${topPercent}%, ${leftPercent}%`);

          markerDiv.innerHTML = `
            <div class="w-[90px] h-[36px] flex items-center justify-center bg-primary text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 marker-clickable">
              <span class="text-sm font-medium">${accommodation.price}</span>
            </div>
          `;

          // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
          markerDiv.addEventListener('click', function (event) {
            console.log(`ğŸ¯ ëŒ€ì²´ ë§ˆì»¤ ${index + 1} í´ë¦­ë¨: ${accommodation.title}`);

            // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
            event.stopPropagation();
            event.preventDefault();

            // ë‹¤ë¥¸ íŒì—…ì´ ì—´ë ¤ìˆìœ¼ë©´ ë¨¼ì € ë‹«ê¸°
            const existingPopup = document.getElementById('infoPopup');
            if (existingPopup && !existingPopup.classList.contains('hidden')) {
              existingPopup.classList.add('hidden');
            }

            // ì‹¤ì œ í´ë¦­í•œ í™”ë©´ ì¢Œí‘œ ì‚¬ìš©
            const mapContainer = document.getElementById('map');
            const mapRect = mapContainer.getBoundingClientRect();

            // í´ë¦­í•œ í™”ë©´ ì¢Œí‘œë¥¼ ì§€ë„ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ ìƒëŒ€ ì¢Œí‘œë¡œ ë³€í™˜
            const clickPosition = {
              x: event.clientX - mapRect.left,
              y: event.clientY - mapRect.top
            };

            console.log('ëŒ€ì²´ ë§ˆì»¤ ì‹¤ì œ í´ë¦­ ìœ„ì¹˜ ê³„ì‚°:', {
              clientX: event.clientX,
              clientY: event.clientY,
              mapRect: {
                left: mapRect.left,
                top: mapRect.top,
                width: mapRect.width,
                height: mapRect.height
              },
              relative: clickPosition
            });

            // í´ë¦­ ìœ„ì¹˜ê°€ ì§€ë„ ì˜ì—­ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
            if (clickPosition.x >= 0 && clickPosition.x <= mapRect.width &&
              clickPosition.y >= 0 && clickPosition.y <= mapRect.height) {
              console.log('âœ… ëŒ€ì²´ ë§ˆì»¤ í´ë¦­ ìœ„ì¹˜ê°€ ì§€ë„ ì˜ì—­ ë‚´ì— ìˆìŒ');
            } else {
              console.log('âš ï¸ ëŒ€ì²´ ë§ˆì»¤ í´ë¦­ ìœ„ì¹˜ê°€ ì§€ë„ ì˜ì—­ì„ ë²—ì–´ë‚¨');
            }

            showAccommodationPopup(accommodation, clickPosition);
          });

          // í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
          markerDiv.addEventListener('mouseenter', function () {
            console.log(`ëŒ€ì²´ ë§ˆì»¤ ${index + 1} í˜¸ë²„: ${accommodation.title}`);
          });

          mapContainer.appendChild(markerDiv);
          console.log(`âœ… ëŒ€ì²´ ë§ˆì»¤ ${index + 1} ìƒì„± ë° ì´ë²¤íŠ¸ ë°”ì¸ë”© ì™„ë£Œ`);
        });

        console.log('âœ… ëŒ€ì²´ ë§ˆì»¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }

      // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
      const searchButton = document.getElementById('searchButton');

      searchButton.addEventListener('click', function () {
        console.log('ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ë¨');

        // ì„ íƒëœ ìº í•‘ íƒ€ì… ê°€ì ¸ì˜¤ê¸°
        const selectedCampingType = document.querySelector('#campingTypeFilter button.bg-primary\\/10');
        const campingType = selectedCampingType ? selectedCampingType.dataset.type : 'glamping';

        // ìº í•‘ íƒ€ì…ì„ í•œêµ­ì–´ë¡œ ë³€í™˜
        const campingTypeMap = {
          'normal': 'ì¼ë°˜ìº í•‘',
          'glamping': 'ê¸€ë¨í•‘',
          'caravan': 'ì¹´ë¼ë°˜',
          'pension': 'íœì…˜',
          'hotel': 'í˜¸í…”',
          'pet': 'ë°˜ë ¤ë™ë¬¼',
          'sharing': 'ê³µìœ ìˆ™ë°•',
          'hotspring': 'ì˜¨ì²œ',
          'resort': 'ë¦¬ì¡°íŠ¸'
        };

        const selectedType = campingTypeMap[campingType] || 'ê¸€ë¨í•‘';

        // ì¸ì›ìˆ˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const adults = parseInt(adultCount.textContent) || 0;
        const children = parseInt(childCount.textContent) || 0;
        const totalPeople = adults + children;

        // ë‚ ì§œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ë‚ ì§œ)
        let checkin = '';
        let checkout = '';
        let nights = 0;

        if (selectedStartCalendarDate && selectedEndCalendarDate) {
          checkin = formatCalendarDate(selectedStartCalendarDate);
          checkout = formatCalendarDate(selectedEndCalendarDate);
          nights = Math.round((selectedEndCalendarDate - selectedStartCalendarDate) / (1000 * 60 * 60 * 24));
        }

        // search_result.htmlì´ ê¸°ëŒ€í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ê²€ìƒ‰ ë°ì´í„° êµ¬ì„±
        const searchData = {
          query: `ê°€í‰ ${selectedType}`, // ê²€ìƒ‰ì–´ (ì§€ì—­ + ìº í•‘íƒ€ì…)
          location: 'ê°€í‰', // ì§€ì—­
          type: selectedType, // ìº í•‘ íƒ€ì…
          checkin: checkin, // ì²´í¬ì¸ ë‚ ì§œ
          checkout: checkout, // ì²´í¬ì•„ì›ƒ ë‚ ì§œ
          nights: nights, // ìˆ™ë°• ì¼ìˆ˜
          maxPrice: 300000, // ê¸°ë³¸ ìµœëŒ€ ê°€ê²© (30ë§Œì›)
          adults: adults, // ì„±ì¸ ìˆ˜
          children: children // ì†Œì¸ ìˆ˜
        };

        // URL íŒŒë¼ë¯¸í„° ìƒì„±
        const params = new URLSearchParams();
        Object.keys(searchData).forEach(key => {
          if (searchData[key] !== '' && searchData[key] !== 0) {
            params.append(key, searchData[key]);
          }
        });

        console.log('ê²€ìƒ‰ ë°ì´í„°:', searchData);
        console.log('ìƒì„±ëœ URL íŒŒë¼ë¯¸í„°:', params.toString());

        // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
        if (totalPeople === 0) {
          alert('ì¸ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        if (!selectedStartCalendarDate || !selectedEndCalendarDate) {
          alert('ì²´í¬ì¸ê³¼ ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        // search_result.htmlë¡œ ì´ë™
        window.location.href = `search_result.html?${params.toString()}`;
      });
    });

    // ìœ„ì‹œë¦¬ìŠ¤íŠ¸ í† ê¸€ ê¸°ëŠ¥
    document.addEventListener('click', function (e) {
      if (e.target.closest('.wishlist-btn')) {
        e.preventDefault();
        e.stopPropagation();

        const button = e.target.closest('.wishlist-btn');
        const icon = button.querySelector('i');

        // í† ê¸€ ì• ë‹ˆë©”ì´ì…˜
        button.style.transform = 'scale(0.8)';

        setTimeout(() => {
          if (icon.classList.contains('ri-heart-line')) {
            // ë¹ˆ í•˜íŠ¸ â†’ ì±„ì›Œì§„ í•˜íŠ¸
            icon.classList.remove('ri-heart-line');
            icon.classList.add('ri-heart-fill');
            button.classList.add('active');
            icon.style.color = '#ef4444';
          } else {
            // ì±„ì›Œì§„ í•˜íŠ¸ â†’ ë¹ˆ í•˜íŠ¸
            icon.classList.remove('ri-heart-fill');
            icon.classList.add('ri-heart-line');
            button.classList.remove('active');
            icon.style.color = '';
          }

          button.style.transform = 'scale(1)';
        }, 100);
      }
    });
  </script>
</body>

</html>